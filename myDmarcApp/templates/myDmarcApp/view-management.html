{% extends 'myDmarcApp/base.html' %}
{% load bootstrap3 %}

{% block title %}MyDmarc - View Management{% endblock %}
{% block site_id %}view-management{% endblock %}


{% block content %}
<div class="col-sm-12 col-md-12 main">
    <h1 class="page-header">View Management</h1>
    <div class="bootstrap-messages-container">
        {% bootstrap_messages %}
    </div>

    <table class="table table-condensed">
        <thead>
            <tr>
                <th>Sort</th>
                <th>Show</th>
                <th>Title</th>
                <th>Description</th> 
                <th style="text-align:center">Actions</th>
            </tr>
        </thead>
        <tbody id="sortableViews">
        {% for view in views %}
            <tr class="view-row" data-id="{{view.id}}">
                <td class="sort-handle"><span class="glyphicon glyphicon-resize-vertical"></span></td>
                <td>{{view.enabled}}</td>
                <td>{{view.title}}</td>
                <td >{{view.description}}</td> 
                <td align="right">
                    <div class="btn-group">
                        <a class="btn btn-default" role="button" href="/deep-analysis/{{view.id}}/">Show</a>
                        <a class="btn btn-default" role="button" href="/edit-view/{{view.id}}/">Edit</a>
                        <a class="btn btn-default" role="button" href="/clone-view/{{view.id}}/">Clone</a>
                        <a class="btn btn-danger"  role="button" href="/delete-view/{{view.id}}/">Delete</a>
                    </div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script type="text/javascript">
    $(document).ready(function(){
        var sortContainer = $("#sortableViews").get(0)
        var sortable = Sortable.create(sortContainer, {
            animation: 150,
            handle: ".sort-handle",
            onUpdate: function (evt){
                //Create ordered Ids Array
                var view_id_list = [];
                $("#sortableViews .view-row").each(function(){
                    view_id_list.push( $(this).data("id") );
                });

                $.ajax({
                    type: "POST",
                    url: /order-views/,
                    data:  JSON.stringify(view_id_list),
                    contentType: "application/json",
                    success: function(response){
                        main.showAjaxMessages(response);
                    },
                });
            }
        });
    })
    </script>
    <div class="row">
        <div class="col-xs-12 text-right">
            <a class="btn btn-important" role="button" href="/add-view/">Add View</a>
        </div>
    </div>
</div>
{% endblock %}