{% extends 'myDmarcApp/base.html' %}
{# Load the tag library #}
{% load bootstrap3 %}

{% block title %}MyDmarc - View Editor{% endblock %}

{% block content %}
<div class="col-sm-3 col-md-2 sidebar">
    <ul class="nav nav-sidebar">
    {% for view in sidebar_views %}
        <li {% if view_form.instance.id and view_form.instance.id == view.id %} class="active" {% endif %} >
            <a href="/edit/{{view.id}}/">{{view.title}}</a>
        </li>
    {% endfor %}
    </ul>
</div>
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <h1>Editor</h1>
    {% bootstrap_messages %}
    <form id="viewFilterForm" method='post' action='/edit/{% if view_form.instance.id %}{{view_form.instance.id}}/ {% endif %}' class="form">
         {% csrf_token %}
         {% load formset_tags %}
        <h2>View</h2>

        {% bootstrap_form view_form %}

        <div>
            <h4>Time</h4>
            {% bootstrap_form_errors view_time_fixed_form %}
            <div class="row">
                <div class="col-md-2">
                    <input type="radio" name="time_switch" disabled>
                </div>
                <div class="col-md-4">
                    {% bootstrap_field view_time_fixed_form.date_range_begin layout='inline' %}
                </div>
                <div class="col-md-4">
                    {% bootstrap_field view_time_fixed_form.date_range_end layout='inline' %}
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    <input type="radio" name="time_switch" disabled>
                </div>
                <div class="col-md-4">
                    {% bootstrap_field view_time_variable_form.quantity layout='inline' %}
                </div>
                <div class="col-md-4">
                    {% bootstrap_field view_time_variable_form.unit layout='inline' %}
                </div>
            </div>
        </div>

        <div id="filterSetContainer" data-formset-prefix="{{ filter_set_formset.prefix }}">
            {{ filter_set_formset.management_form }}

            <h3>Filters</h3>

            <div data-formset-body>
                <!-- New forms will be inserted in here -->
                {% for filter_set_form in filter_set_formset%}
                    <div data-formset-form>
                        <h4>Filter</h4>
                    {% bootstrap_field filter_set_form.id %}
                    {% bootstrap_field filter_set_form.label %}
                    {% bootstrap_field filter_set_form.color %}
                    {% bootstrap_field filter_set_form.source_ip %}
                    {% bootstrap_field filter_set_form.report_sender %}
                    {% bootstrap_field filter_set_form.report_receiver_domain %}
                    {% bootstrap_field filter_set_form.raw_dkim_domain %}
                    {% bootstrap_field filter_set_form.raw_spf_domain %}
                    {% bootstrap_field filter_set_form.raw_dkim_result %}
                    {% bootstrap_field filter_set_form.raw_spf_result %}
                    {% bootstrap_field filter_set_form.aligned_dkim_result %}
                    {% bootstrap_field filter_set_form.aligned_spf_result %}
                    {% bootstrap_field filter_set_form.disposition %}
                    
                    {% bootstrap_field filter_set_form.DELETE form_group_class="hidden" %}
                    <button type="button" class="form-control" data-formset-delete-button>Delete form</button>
                    </div>
                {% endfor %}
            </div>

            <!-- The empty form template. By wrapping this in a <script> tag, the
            __prefix__ placeholder can easily be replaced in both attributes and
            any scripts -->
            <script type="form-template" data-formset-empty-form>
                {% escapescript %}
                <div data-formset-form>
                    <h4>Filter</h4>
                    {% bootstrap_field filter_set_formset.empty_form.label %}
                    {% bootstrap_field filter_set_formset.empty_form.color %}
                    {% bootstrap_field filter_set_formset.empty_form.source_ip %}
                    {% bootstrap_field filter_set_formset.empty_form.report_sender %}
                    {% bootstrap_field filter_set_formset.empty_form.report_receiver_domain %}
                    {% bootstrap_field filter_set_formset.empty_form.raw_dkim_domain %}
                    {% bootstrap_field filter_set_formset.empty_form.raw_spf_domain %}
                    {% bootstrap_field filter_set_formset.empty_form.raw_dkim_result %}
                    {% bootstrap_field filter_set_formset.empty_form.raw_spf_result %}
                    {% bootstrap_field filter_set_formset.empty_form.aligned_dkim_result %}
                    {% bootstrap_field filter_set_formset.empty_form.aligned_spf_result %}
                    {% bootstrap_field filter_set_formset.empty_form.disposition %}

                    {% bootstrap_field filter_set_formset.empty_form.DELETE form_group_class="hidden" %}
                    <button type="button" class="form-control" data-formset-delete-button>Delete form</button>
                </div>
                {% endescapescript %}
            </script>

            <!-- This button will add a new form when clicked -->
            <input type="button" class="form-control" value="Add another" data-formset-add>
            <script type="text/javascript">
                $(function($) {
                    $("#filterSetContainer").formset({
                        'animateForms': true,
                    });
                })
            </script>
        </div>
        <input class="form-control btn btn-warning" type="submit" value="Y U DO TIZ JOKR?! ;(">
    </form>
</div>

{% endblock %}
